#!/usr/bin/env bash
#? List existing book both remote and local
#? Usage: tb2 book list
#? config dependencies: GH_OWNER_NAME, MDBOOK_SERIES_NAME, MDBOOK_SRC_DIR

set -euo pipefail

base_dir="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)/../../.."
source "$base_dir/utils.sh"

log "Checking for config..."
checkConf true "MDBOOK_SRC_DIR" "PROJECT_NAME"
srcDir=$("$base_dir/tb2" config get 'MDBOOK_SRC_DIR')
projectName=$("$base_dir/tb2" config get 'PROJECT_NAME')
mustVar true "srcDir" "projectName"
log "done."

info "=Remote [GitHub Issues]="
log "=========================="
run "gh issue list --repo \"$projectName\" --search \"title:Book:\" --state all"

info "=Local [mdBook directory]="
log "=========================="
run "ls -d ./${srcDir:-src}/*/ 2>/dev/null || echo 'No local books found.'"
log "========================"
exit 0
