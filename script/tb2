#!/usr/bin/env bash

set -euo pipefail

ROOT="$(cd "$(dirname "$(readlink -f "$0")")" && pwd)"
export ROOT
. "$ROOT/utils.sh"

if ! [ "$1" = "config" ] && ! [ "$1" = "update" ] && ! [ "$1" = "uninstall" ]; then
  if ! mdbook_chkAvailable; then
    warn "this directory is not in mdbook."
    log "Exit."
    exit 1
  fi
  if ! gh_chkAvailable && tb2_isManualMode; then
    warn "not installed gh. please install github cli or use manual mode."
    log "Exit."
    exit 1
  fi
fi

case "${1:-}" in
  ""|"-i")
    "$ROOT/interactive/main.sh" "${@:2}"
    ;;
  "--help"|"-h")
    "$ROOT/subcmds/help.d/help"
    ;;
  *)
    if [ ! -f "$ROOT/subcmds/$1.d/$1" ] || [ ! -x "$ROOT/subcmds/$1.d/$1" ]; then
      warn "Unknown subcommand: $1"
      info "Run '$0 --help' for usage."
      exit 1
    fi
    "$ROOT/subcmds/$1.d/$1" "${@:2}"
    ;;
esac
