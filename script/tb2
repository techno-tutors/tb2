#!/usr/bin/env bash

set -euo pipefail

SCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"
if git_root=$(git -C "$SCRIPT_DIR" rev-parse --show-toplevel 2>/dev/null); then
  ROOT="$git_root/script"
else
  ROOT="$SCRIPT_DIR/../script"
fi
. "$ROOT/utils.sh"

if ! mdbook_chkAvailable; then
  warn "Exit.."
  exit 1
fi

if ! gh_chkAvailable; then
  warn "Exit.."
  exit 1
fi

case "${1:-}" in
  ""|"-i")
    "$ROOT/interactive/main.sh" "${@:2}"
    ;;
  "--help"|"-h")
    "$ROOT/subcmds/help.d/help"
    ;;
  *)
    if [ ! -f "$ROOT/subcmds/$1.d/$1" ] || [ ! -x "$ROOT/subcmds/$1.d/$1" ]; then
      warn "Unknown subcommand: $1"
      info "Run '$0 --help' for usage."
      exit 1
    fi
    "$ROOT/subcmds/$1.d/$1" "${@:2}"
    ;;
esac