#!/usr/bin/env bash

set -euo pipefail

SCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"
ROOT="$SCRIPT_DIR/../share/tb2/script"
. "$ROOT/utils.sh"

if ! [ "$1" = "config" ] && ! mdbook_chkAvailable; then
  log "Exit."
  exit 1
fi

if ! gh_chkAvailable; then
  log "Exit."
  exit 1
fi

case "${1:-}" in
  ""|"-i")
    "$ROOT/interactive/main.sh" "${@:2}"
    ;;
  "--help"|"-h")
    "$ROOT/subcmds/help.d/help"
    ;;
  *)
    if [ ! -f "$ROOT/subcmds/$1.d/$1" ] || [ ! -x "$ROOT/subcmds/$1.d/$1" ]; then
      warn "Unknown subcommand: $1"
      info "Run '$0 --help' for usage."
      exit 1
    fi
    "$ROOT/subcmds/$1.d/$1" "${@:2}"
    ;;
esac
